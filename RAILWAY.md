# Railway Deployment Guide

This guide will help you deploy the Claude Projects Clone application to Railway.

## 🚀 Quick Start

### 1. Prerequisites

- Railway account ([sign up here](https://railway.app))
- Railway CLI installed (`npm install -g @railway/cli`)
- Your repository pushed to GitHub

### 2. Initial Setup

1. **Login to Railway CLI**
   ```bash
   railway login
   ```

2. **Create a new Railway project**
   ```bash
   railway create claude-projects-clone
   ```

3. **Link your repository**
   - Go to [Railway Dashboard](https://railway.app/dashboard)
   - Click "New Project" → "Deploy from GitHub repo"
   - Select your repository

### 3. Add Database Services

#### PostgreSQL Database
1. In Railway dashboard, click "Add Service" → "Database" → "PostgreSQL"
2. Railway will automatically create a PostgreSQL instance
3. Note the connection details from the "Connect" tab

#### Redis Cache
1. Click "Add Service" → "Database" → "Redis"
2. Railway will automatically create a Redis instance
3. Note the connection details from the "Connect" tab

### 4. Configure Environment Variables

In your Railway project dashboard, go to the main service → "Variables" tab and add:

```env
# Application
NODE_ENV=production

# Database (auto-generated by Railway PostgreSQL service)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Redis (auto-generated by Railway Redis service) 
REDIS_URL=${{Redis.REDIS_URL}}

# JWT Secrets (generate secure 32+ character strings)
JWT_SECRET=your-super-secure-jwt-secret-min-32-chars
JWT_REFRESH_SECRET=your-super-secure-refresh-secret-min-32-chars

# AI API Keys
OPENAI_API_KEY=sk-your-openai-api-key-here
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here

# File Upload
MAX_FILE_SIZE=52428800

# Logging
LOG_LEVEL=info

# Admin Configuration  
ADMIN_EMAIL=admin@yourdomain.com
DEFAULT_TOKEN_LIMIT_GLOBAL=1000000
DEFAULT_TOKEN_LIMIT_MONTHLY=100000

# Optional: Auto-run migrations
RUN_MIGRATIONS=true
```

### 5. Deploy

1. **Automatic Deployment**
   - Railway will automatically deploy when you push to your main branch
   - Monitor the build logs in the Railway dashboard

2. **Manual Deployment**
   ```bash
   railway up
   ```

## 🔧 Configuration Details

### Dockerfile
The project includes a Railway-optimized `Dockerfile` that:
- Builds both frontend and backend in a single container
- Uses Nginx to serve the frontend and proxy API requests
- Includes health checks and proper signal handling

### Services Architecture
```
┌─────────────────┐    ┌──────────────┐    ┌─────────────┐
│   Frontend      │    │   Backend    │    │ PostgreSQL  │
│   (Nginx)       │◄──►│   (Node.js)  │◄──►│ Database    │
│   Port: $PORT   │    │   Port: 3001 │    │             │
└─────────────────┘    └──────────────┘    └─────────────┘
                              │
                              ▼
                       ┌─────────────┐
                       │    Redis    │
                       │    Cache    │
                       └─────────────┘
```

### Domain & SSL
- Railway automatically provides HTTPS domains
- Custom domains can be configured in the project settings
- SSL certificates are automatically managed

## 🛠️ Advanced Configuration

### Custom Domain
1. Go to project → "Settings" → "Domains"
2. Add your custom domain
3. Configure DNS records as shown

### Scaling
- Railway automatically handles scaling based on traffic
- You can configure scaling limits in project settings

### Monitoring
- View logs: `railway logs`
- Monitor metrics in the Railway dashboard
- Set up alerts for critical events

## 🔍 Troubleshooting

### Common Issues

#### Build Failures
```bash
# Check build logs
railway logs --service your-service-name

# Redeploy
railway redeploy
```

#### Database Connection Issues
- Verify `DATABASE_URL` environment variable
- Check PostgreSQL service is running
- Review connection limits

#### Environment Variables
```bash
# List current variables
railway variables

# Add a variable
railway variables set KEY=value
```

### Health Checks
The application includes health endpoints:
- Backend: `https://your-app.railway.app/api/health`
- Overall: Railway monitors the main port automatically

### Logs
```bash
# View recent logs
railway logs

# Follow logs in real-time
railway logs --follow

# Filter by service
railway logs --service backend
```

## 📊 Performance Optimization

### Database
- Enable connection pooling (already configured)
- Consider read replicas for high traffic
- Monitor query performance

### Caching
- Redis is configured for session storage and rate limiting
- Consider adding application-level caching

### Frontend
- Static assets are served with long cache headers
- Gzip compression is enabled
- Consider CDN for global distribution

## 🔒 Security

### Environment Variables
- Never commit secrets to version control
- Use Railway's secret management
- Rotate secrets regularly

### Database Security
- Railway PostgreSQL includes SSL by default
- Use strong passwords
- Limit database access

### Application Security
- CORS is configured for your domain
- Security headers are set by Nginx
- Rate limiting is implemented

## 📞 Support

- [Railway Documentation](https://docs.railway.app)
- [Railway Discord](https://discord.gg/railway)
- [GitHub Issues](https://github.com/your-username/claude-projects-clone/issues)

## 🚀 Next Steps

After successful deployment:

1. **Set up monitoring** - Configure alerts and monitoring
2. **Custom domain** - Add your custom domain
3. **Backup strategy** - Set up database backups
4. **CI/CD** - Configure automated testing and deployment
5. **Performance tuning** - Monitor and optimize performance

---

Happy deploying! 🎉
